<!doctype html><html lang=en-us><head><title>Linux File System // goatwu1993</title><link rel="shortcut icon" href=/favicon.ico><meta charset=utf-8><meta name=generator content="Hugo 0.79.1"><meta name=viewport content="width=device-width,initial-scale=1"><meta name=author content="goatwu1993"><meta name=description content><link rel=stylesheet href=https://goatwu1993.github.io/blog/css/main.min.4a7ec8660f9a44b08c4da97c5f2e31b1192df1d4d0322e65c0dbbc6ecb1b863f.css><meta name=twitter:card content="summary"><meta name=twitter:title content="Linux File System"><meta name=twitter:description content="linux file system"><meta property="og:title" content="Linux File System"><meta property="og:description" content="linux file system"><meta property="og:type" content="article"><meta property="og:url" content="https://goatwu1993.github.io/blog/posts/linux/fs/"><meta property="article:published_time" content="2022-09-26T00:00:00+00:00"><meta property="article:modified_time" content="2022-09-26T00:00:00+00:00"></head><body><header class=app-header><a href=https://goatwu1993.github.io/blog/><img class=app-header-avatar src=/blog/avatar.jpg alt=goatwu1993></a><h1>goatwu1993</h1><nav class=app-header-menu><a class=app-header-menu-item href=/blog/>Home</a>
-
<a class=app-header-menu-item href=/blog/tags/>Tags</a>
-
<a class=app-header-menu-item href=/blog/about/>About</a></nav><p>Taiwan. Backend/DevOps. Python.</p><div class=app-header-social><a href=https://github.com/goatwu1993 target=_blank rel="noreferrer noopener"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="icon icon-github"><title>Github</title><path d="M9 19c-5 1.5-5-2.5-7-3m14 6v-3.87a3.37 3.37.0 00-.94-2.61c3.14-.35 6.44-1.54 6.44-7A5.44 5.44.0 0020 4.77 5.07 5.07.0 0019.91 1S18.73.65 16 2.48a13.38 13.38.0 00-7 0C6.27.65 5.09 1 5.09 1A5.07 5.07.0 005 4.77a5.44 5.44.0 00-1.5 3.78c0 5.42 3.3 6.61 6.44 7A3.37 3.37.0 009 18.13V22"/></svg></a><a href=https://www.cakeresume.com/peteeelol target=_blank rel="noreferrer noopener"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="icon icon-link"><path d="M10 13a5 5 0 007.54.54l3-3a5 5 0 00-7.07-7.07l-1.72 1.71"/><path d="M14 11a5 5 0 00-7.54-.54l-3 3a5 5 0 007.07 7.07l1.71-1.71"/></svg></a></div></header><main class=app-container><article class=post><header class=post-header><h1 class=post-title>Linux File System</h1><div class=post-meta><div><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="icon icon-calendar"><title>calendar</title><rect x="3" y="4" width="18" height="18" rx="2" ry="2"/><line x1="16" y1="2" x2="16" y2="6"/><line x1="8" y1="2" x2="8" y2="6"/><line x1="3" y1="10" x2="21" y2="10"/></svg>Sep 26, 2022</div><div><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="icon icon-clock"><title>clock</title><circle cx="12" cy="12" r="10"/><polyline points="12 6 12 12 16 14"/></svg>1 min read</div><div><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="icon icon-tag"><title>tag</title><path d="M20.59 13.41l-7.17 7.17a2 2 0 01-2.83.0L2 12V2h10l8.59 8.59a2 2 0 010 2.82z"/><line x1="7" y1="7" x2="7.01" y2="7"/></svg><a class=tag href=https://goatwu1993.github.io/blog/tags/fs/>fs</a></div></div></header><div class=post-content><h2 id=sector-磁區>Sector (磁區)</h2><p>磁碟本身最小的單位是Sector</p><h2 id=block-塊>Block (塊)</h2><p>Block為類Unix系統在讀寫時的最小單位，是由八個sector(磁區)組成的4k位元組的block(塊)。</p><h2 id=formatting-格式化>Formatting (格式化)</h2><p>檔案系統在格式化的時候，就會把儲存區域分成兩大連續的儲存區域。</p><p>一個用來儲存檔案系統的metadata，這是由inode組成的表，每個inode預設是256個位元組
格式化時另一個儲存區域，用來儲存檔案系統物件的內容資料。</p><h2 id=inode>inode</h2><p>inode 是描述一個檔案的metadata的資料結構，每個inode是由256/128個位元組組成</p><p>典型的實現下，所有inode佔檔案系統1%的儲存空間。</p><p>每個檔案對應一個inode，並用一個整數來辨識，這個整數被成為inumber/inode number</p><p>inode儲存了檔案系統物件的metadata，如</p><ol><li>所有者</li><li>存取權限</li><li>類型(檔案/目錄)</li><li>創建時間</li><li>內容修改時間</li><li>inode修改時間</li><li>上次存取時間</li></ol><p>兩個檔案的inode相同，則兩個檔案互為硬連結。</p><h2 id=stat>Stat</h2><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>bash-4.1$ stat -x tmp.txt
  File: <span style=color:#e6db74>&#34;tmp.txt&#34;</span>
  Size: <span style=color:#ae81ff>11108523</span>     FileType: Regular File
  Mode: <span style=color:#f92672>(</span>0644/-rw-r--r--<span style=color:#f92672>)</span>         Uid: <span style=color:#f92672>(</span>  502/peter_wu<span style=color:#f92672>)</span>  Gid: <span style=color:#f92672>(</span>   20/   staff<span style=color:#f92672>)</span>
Device: 1,5   Inode: <span style=color:#ae81ff>106433545</span>    Links: <span style=color:#ae81ff>1</span>
Access: Tue Aug <span style=color:#ae81ff>30</span> 19:10:58 <span style=color:#ae81ff>2022</span>
Modify: Tue Aug <span style=color:#ae81ff>30</span> 19:10:55 <span style=color:#ae81ff>2022</span>
Change: Tue Aug <span style=color:#ae81ff>30</span> 19:10:55 <span style=color:#ae81ff>2022</span>
 Birth: Tue Aug <span style=color:#ae81ff>30</span> 19:10:55 <span style=color:#ae81ff>2022</span>
</code></pre></div><h2 id=check-system-inode-usage>Check System Inode Usage</h2><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>bash-5.1$ df -ih
Filesystem       Size   Used  Avail Capacity iused      ifree %iused  Mounted on
/dev/disk1s1s1  466Gi   14Gi  216Gi     7%  <span style=color:#ae81ff>502048</span> <span style=color:#ae81ff>2260109880</span>    0%   /
devfs           193Ki  193Ki    0Bi   100%     <span style=color:#ae81ff>666</span>          <span style=color:#ae81ff>0</span>  100%   /dev
/dev/disk1s5    466Gi  5.0Gi  216Gi     3%       <span style=color:#ae81ff>5</span> <span style=color:#ae81ff>2260109880</span>    0%   /System/Volumes/VM
/dev/disk1s3    466Gi  767Mi  216Gi     1%    <span style=color:#ae81ff>3363</span> <span style=color:#ae81ff>2260109880</span>    0%   /System/Volumes/Preboot
/dev/disk1s6    466Gi   10Mi  216Gi     1%      <span style=color:#ae81ff>16</span> <span style=color:#ae81ff>2260109880</span>    0%   /System/Volumes/Update
/dev/disk1s2    466Gi  229Gi  216Gi    52% <span style=color:#ae81ff>2426594</span> <span style=color:#ae81ff>2260109880</span>    0%   /System/Volumes/Data
map auto_home     0Bi    0Bi    0Bi   100%       <span style=color:#ae81ff>0</span>          <span style=color:#ae81ff>0</span>  100%   /System/Volumes/Data/home
</code></pre></div><h2 id=check-system-inode-usage-1>Check System Inode Usage</h2><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=color:#66d9ef>for</span> i in /*; <span style=color:#66d9ef>do</span> echo $i; find $i |wc -l; <span style=color:#66d9ef>done</span>
</code></pre></div></div><div class=post-footer></div></article></main></body></html>